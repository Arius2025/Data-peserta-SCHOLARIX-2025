<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DATA PESERTA SCOLARIX 2025</title>

  <!-- ✅ Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      color: #1b5e20;
      background: linear-gradient(to bottom right, #e8f5e9, #ffffff);
      background-image: url('https://images.unsplash.com/photo-1607083206173-3e3b5c3b6b2e?auto=format&fit=crop&w=1600&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }
    .overlay {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 30px;
      min-height: 100vh;
      width: 100%;
      margin: auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 16px;
      transition: opacity 0.5s ease-in-out;
    }
    h1 {
      text-align: center;
      color: #2e7d32;
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px #210ab6;
    }
    .table-rounded {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0, 128, 0, 0.1);
    }
    .table-rounded th,
    .table-rounded td {
      border: none;
    }
    .table-rounded thead th {
      border-bottom: 2px solid #c8e6c9;
    }
    .table-hover tbody tr:hover {
      background-color: #f1f8e9;
    }
    table {
      font-size: 14px;
    }
    table th {
      background-color: #aca5d6 !important;
      color: #2e1b5e !important;
    }
    table td {
      background-color: #ffffff;
    }
    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #4a338c;
      border-top: 1px solid #c8e6c9;
      padding-top: 10px;
    }
    select {
      font-size: 12px;
    }
    #loading {
      text-align: center;
      color: #2d2d83;
      font-weight: bold;
      margin-bottom: 20px;
    }

    /* ✅ Styling pencarian */
    .dataTables_filter {
      text-align: center !important;
      margin-bottom: 20px;
    }
    .dataTables_filter label {
      font-weight: bold;
      color: #2e7d32;
    }
    .dataTables_filter input {
      border: 2px solid #8489cf;
      border-radius: 8px;
      padding: 6px 12px;
      background-color: #ffffff;
      color: #1b5e20;
      font-size: 14px;
      box-shadow: 0 0 4px rgba(129, 199, 132, 0.3);
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <h1>DATA PESERTA SCOLARIX 2025</h1>
    <div id="loading">Memuat data peserta...</div>
    <div class="table-responsive">
      <table id="data-table" class="table table-hover table-bordered table-striped align-middle w-100 table-rounded" style="table-layout: auto;">
        <thead><tr><th>No</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <footer>
      Mitra Prestasi sebagai pemilik website
    </footer>
  </div>

  <!-- ✅ Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <script>
    const sheetID = "1QQSW60HnZY4Qmw-aOaYRtm_jKYiA2Si-aKiL-uBAtVY";
    const sheetName = "Form Responses 1";
    const apiKey = "AIzaSyDYwAmxv5CW2iTX-GxDdMmDvyf5H7m0KXM";
    const hiddenKeywords = ["timestamp", "nomor handphone", "bukti transfer", "UPLOAD BUKTI TRANSFER - BCA 2000750843 (SRI HANDAYANI)"];

    async function fetchSheetData() {
      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;
        const res = await fetch(url);
        const json = await res.json();
        const [headers, ...rows] = json.values;

        const visibleHeaders = headers.filter(h =>
          !hiddenKeywords.some(keyword => h.toLowerCase().includes(keyword))
        );

        const tableHead = document.querySelector("#data-table thead tr");
        tableHead.innerHTML = "<th>No</th>" + visibleHeaders.map(h => `<th>${h}</th>`).join("");

        const tableBody = document.querySelector("#data-table tbody");
        let rowIndex = 1;
        tableBody.innerHTML = rows.map(row => {
          const obj = {};
          headers.forEach((h, idx) => {
            obj[h] = row[idx] || "";
          });
          const isEmpty = visibleHeaders.every(h => !(obj[h] || "").trim());
          if (isEmpty) return "";
          return `<tr><td>${rowIndex++}</td>` +
                 visibleHeaders.map(h => `<td>${obj[h]}</td>`).join("") +
                 `</tr>`;
        }).join("");

        document.getElementById("loading").style.display = "none";

        const table = $('#data-table').DataTable({
          pageLength: 50,
          initComplete: function () {
            this.api().columns().every(function () {
              const column = this;
              if (column.index() === 0) return;
              const select = $('<select><option value="">Filter</option></select>')
                .appendTo($(column.header()).empty())
                .on('change', function () {
                  const val = $.fn.dataTable.util.escapeRegex($(this).val());
                  column.search(val ? '^' + val + '$' : '', true, false).draw();
                });
              column.data().unique().sort().each(function (d) {
                if (d.trim()) select.append('<option value="' + d + '">' + d + '</option>');
              });
            });
          }
        });

        // ✅ Ganti label dan placeholder pencarian
        $(".dataTables_filter label").contents().filter(function() {
          return this.nodeType === 3;
        }).first().replaceWith("Cari: ");
        $(".dataTables_filter input").attr("placeholder", "Masukkan nama peserta");

      } catch (error) {
        document.getElementById("loading").textContent = "Gagal memuat data.";
        document.getElementById("loading").style.color = "red";
        console.error("Error fetching data:", error);
      }
    }

    fetchSheetData();
  </script>
</body>
</html>
